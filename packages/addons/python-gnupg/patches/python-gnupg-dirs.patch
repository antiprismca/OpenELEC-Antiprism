--- python-gnupg-0.3.7/gnupg.py	2014-12-07 13:46:19.000000000 -0500
+++ python-gnupg-0.3.7.patch/gnupg.py	2015-01-20 00:27:55.340660692 -0500
@@ -675,8 +675,6 @@ class GPG(object):
         # falling back to utf-8, because gpg itself uses latin-1 as the default
         # encoding.
         self.encoding = 'latin-1'
-        if gnupghome and not os.path.isdir(self.gnupghome):
-            os.makedirs(self.gnupghome,0x1C0)
         p = self._open_subprocess(["--version"])
         result = self.result_map['verify'](self) # any result will do for this
         self._collect_output(p, result, stdin=p.stdin)
@@ -1187,13 +1185,18 @@ class GPG(object):
         parms.setdefault('Key-Type','RSA')
         parms.setdefault('Key-Length',2048)
         parms.setdefault('Name-Real', "Autogenerated Key")
+        logname = None
         try:
             logname = os.environ['LOGNAME']
         except KeyError:
-            logname = os.environ['USERNAME']
-        hostname = socket.gethostname()
-        parms.setdefault('Name-Email', "%s@%s" % (logname.replace(' ', '_'),
-                                                  hostname))
+            try:
+                logname = os.environ['USERNAME']
+            except KeyError:
+                pass
+        if logname != None: 
+            hostname = socket.gethostname()
+            parms.setdefault('Name-Email', "%s@%s" % (logname.replace(' ', '_'),
+                                                      hostname))
         out = "Key-Type: %s\n" % parms.pop('Key-Type')
         for key, val in list(parms.items()):
             out += "%s: %s\n" % (key, val)
